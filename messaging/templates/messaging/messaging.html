{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Togetherly - Messaging</title>
  <link rel="stylesheet" href="{% static 'messaging/messaging.css' %}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="navbar">
        <div class="logo">
            <div class="logo-icon">
                <div class="logo-circle"></div>
                <div class="logo-circle"></div>
                <div class="logo-circle"></div>
            </div>
            <span class="logo-text">Togetherly</span>
        </div>
        <div class="search-container">
            <div class="search-box">
                <input type="text" class="search-input" placeholder="Search...">
                <button class="search-btn" style="position: absolute; top: 0rem;">
                    <i class="fas fa-search"></i>
                </button>
            </div>
        </div>
        <div class="nav-links">
            {% if user.is_authenticated %}
                <div class="nav-item">
                    <a href="{% url 'home' %}"><i class="fas fa-home"></i> Home</a>
                </div>
                <div class="nav-item">
                    <a href="{% url 'profile' %}"><i class="fas fa-user"></i> {{ user.first_name|default:user.username }} </a>
                </div>
                <div class="nav-item">
                    <a href="{% url 'messaging' %}" style="color: #7c6cf9; transform: scale(1.1);"><i class="fas fa-envelope"></i> Messages</a>
                </div>
                <div class="nav-item">
                    <a href="{% url 'connections' %}"><i class="fas fa-users"></i> Connections</a>
                </div>
                <div class="nav-item">
                    <a href="{% url 'logout' %}"><i class="fas fa-sign-out-alt"></i> Logout</a>
                </div>
                
            {% else %}
                <div class="nav-item">
                    <a href="{% url 'login' %}"><i class="fas fa-sign-in-alt"></i> Login</a>
                </div>
                <div class="nav-item">
                    <a href="{% url 'signup' %}"><i class="fas fa-user-plus"></i> Sign Up</a>
                </div>
            {% endif %}
            <div class="nav-item">
                <button class="theme-toggle" id="themeToggle">
                    <i class="fas fa-moon"></i>
                </button>
            </div>
        </div>        
    </div>

    <!-- Elfsight AI Chatbot | Untitled AI Chatbot -->
    <script src="https://static.elfsight.com/platform/platform.js" async></script>
    <div class="elfsight-app-5377efc7-849e-41e6-b925-15c160b1ebd8" data-elfsight-app-lazy></div>

  <div class="content container">
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <span>Messages</span>
        </div>
        <div class="sidebar-search">
            <input type="text" placeholder="Search messages">
        </div>
        <ul class="conversations">
            <li class="conversation-item active">
            <div class="avatar">
                <img src="https://as1.ftcdn.net/jpg/03/39/45/96/1000_F_339459697_XAFacNQmwnvJRqe1Fe9VOptPWMUxlZP8.jpg" alt="avatar">
            </div>
            <div class="conversation-content">
                <div class="name">
                <span>Alex Johnson</span>
                <span class="time">10:45 AM</span>
                </div>
                <div class="preview">I'd be happy to chat about potential collaborations...</div>
            </div>
            </li>
            <li class="conversation-item">
            <div class="avatar">EM</div>
            <div class="conversation-content">
                <div class="name">
                <span>Emily Wong</span>
                <span class="time">Yesterday</span>
                </div>
                <div class="preview">Your tips about user feedback collection were helpful!</div>
            </div>
            </li>
            <li class="conversation-item">
            <div class="avatar">MC</div>
            <div class="conversation-content">
                <div class="name">
                <span>Michael Chen</span>
                <span class="time">2 days ago</span>
                </div>
                <div class="preview">Thanks for the recommendations! We'll take a look...</div>
            </div>
            </li>
            <li class="conversation-item">
            <div class="avatar">
                <img src="https://as1.ftcdn.net/jpg/03/39/45/96/1000_F_339459697_XAFacNQmwnvJRqe1Fe9VOptPWMUxlZP8.jpg" alt="avatar">
            </div>
            <div class="conversation-content">
                <div class="name">
                <span>Sarah Peters</span>
                <span class="time">3 days ago</span>
                </div>
                <div class="preview">The proposal looks great! Let's discuss on Monday.</div>
            </div>
            </li>
            <li class="conversation-item">
            <div class="avatar">JD</div>
            <div class="conversation-content">
                <div class="name">
                <span>James Decker</span>
                <span class="time">1 week ago</span>
                </div>
                <div class="preview">I'm excited to collaborate on the new project!</div>
            </div>
            </li>
        </ul>
        <button class="new-message-btn">
            <i class="fas fa-plus"></i> New Message
        </button>
    </aside>

    <main class="chat-container">
      <div class="chat-header">
        <div class="chat-header-info">
          <div class="avatar">
            <img src="https://as1.ftcdn.net/jpg/03/39/45/96/1000_F_339459697_XAFacNQmwnvJRqe1Fe9VOptPWMUxlZP8.jpg" alt="avatar">
          </div>
          <div>
            <h3>Alex Johnson <span class="online-badge"></span></h3>
            <span class="preview">Online</span>
          </div>
        </div>
        <div class="chat-header-actions">
          <button class="action-btn">
            <i class="fas fa-phone"></i>
          </button>
          <button class="action-btn">
            <i class="fas fa-video"></i>
          </button>
          <button class="action-btn">
            <i class="fas fa-info-circle"></i>
          </button>
        </div>
      </div>

      <div class="chat-messages" id="chat-messages">
        <div class="message message-received">
          <p>Hi Sarah, I saw your post about marketing strategies. I'd love to connect and discuss some collaboration opportunities.</p>
          <span class="message-time">10:23 AM</span>
        </div>
        <div class="message message-sent">
          <p>Hi Alex! Thanks for reaching out. I'd be happy to chat about potential collaborations. What did you have in mind?</p>
          <span class="message-time">10:45 AM</span>
        </div>
        <div class="message message-received">
          <p>Great! We're launching a new product next month and looking for effective go-to-market strategies. Your experience would be valuable. Are you free for a call this week?</p>
          <span class="message-time">11:02 AM</span>
        </div>
        <!-- More messages will be added dynamically -->
      </div>

      <div class="chat-input-container">
        <button class="attach-btn">
          <i class="fas fa-paperclip"></i>
        </button>
        <input type="text" class="chat-input" id="message-input" placeholder="Type a message...">
        <button class="attach-btn">
          <i class="far fa-smile"></i>
        </button>
        <button class="send-btn" id="send-btn">
          <i class="fas fa-paper-plane"></i>
        </button>
      </div>
    </main>
  </div>

  <script>
    
    document.querySelector('.search-btn').addEventListener('click', function() {
        document.querySelector('.search-input').focus();
    });

    // theme toggle
    const themeToggle = document.getElementById('themeToggle');
    // Function to toggle theme and save preference
    if (themeToggle) {
        themeToggle.addEventListener('click', () => {
            document.body.classList.toggle('dark-mode');
            // Save the current theme preference in localStorage
            const currentTheme = document.body.classList.contains('dark-mode') ? 'dark-mode' : 'light-mode';
            localStorage.setItem('theme', currentTheme);
        });
    }
    // Function to apply the saved theme on page load
    function applySavedTheme() {
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'dark-mode') {
            document.body.classList.add('dark-mode');
        } else {
            document.body.classList.remove('dark-mode');
        }
    }
    applySavedTheme();
    
    // Mobile menu toggle
    const mobileMenuBtn = document.getElementById('mobile-menu');
    const sidebar = document.getElementById('sidebar');
    
    mobileMenuBtn.addEventListener('click', () => {
      sidebar.classList.toggle('active');
    });
    
    // Send message functionality
    const sendBtn = document.getElementById('send-btn');
    const messageInput = document.getElementById('message-input');
    const chatMessages = document.getElementById('chat-messages');
    
    sendBtn.addEventListener('click', sendMessage);
    messageInput.addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        sendMessage();
      }
    });
    
    function sendMessage() {
      const message = messageInput.value.trim();
      
      if (message !== '') {
        // Create new message element
        const messageElement = document.createElement('div');
        messageElement.classList.add('message', 'message-sent');
        
        // Get current time
        const now = new Date();
        const hours = now.getHours();
        const minutes = now.getMinutes();
        const formattedTime = `${hours}:${minutes < 10 ? '0' + minutes : minutes}`;
        
        // Add message content
        messageElement.innerHTML = `
          <p>${message}</p>
          <span class="message-time">${formattedTime}</span>
        `;
        
        // Add to chat
        chatMessages.appendChild(messageElement);
        
        // Clear input
        messageInput.value = '';
        
        // Scroll to bottom
        chatMessages.scrollTop = chatMessages.scrollHeight;
        
        // Simulate response after a delay
        if (Math.random() > 0.5) {
          setTimeout(() => {
            const responses = [
              "That sounds great! Can we set up a meeting to discuss further?",
              "Thanks for sharing. I'll review and get back to you soon.",
              "Interesting approach! Have you considered alternative strategies?",
              "I appreciate your insights. Let me connect you with our team lead."
            ];
            
            const randomResponse = responses[Math.floor(Math.random() * responses.length)];
            
            const responseElement = document.createElement('div');
            responseElement.classList.add('message', 'message-received');
            responseElement.innerHTML = `
              <p>${randomResponse}</p>
              <span class="message-time">${formattedTime}</span>
            `;
            
            chatMessages.appendChild(responseElement);
            chatMessages.scrollTop = chatMessages.scrollHeight;
          }, 1500);
        }
      }
    }
    
    // Add ripple effect to buttons
    const buttons = document.querySelectorAll('.btn, .send-btn, .new-message-btn');
    
    buttons.forEach(button => {
      button.addEventListener('click', function(e) {
        const ripple = document.createElement('span');
        const rect = this.getBoundingClientRect();
        
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        
        ripple.style.left = x + 'px';
        ripple.style.top = y + 'px';
        
        this.appendChild(ripple);
        
        setTimeout(() => {
          ripple.remove();
        }, 600);
      });
    });
    
    // Conversation item click
    const conversationItems = document.querySelectorAll('.conversation-item');
    
    conversationItems.forEach(item => {
      item.addEventListener('click', function() {
        // Remove active class from all items
        conversationItems.forEach(i => i.classList.remove('active'));
        
        // Add active class to clicked item
        this.classList.add('active');
        
        // On mobile, close sidebar after selection
        if (window.innerWidth <= 768) {
          sidebar.classList.remove('active');
        }
      });
    });
  </script>
</body>
</html>